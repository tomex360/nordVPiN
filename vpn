#!/bin/bash

ccode=$1
default="us"

cserver=$(ls /etc/openvpn/$1* | shuf -n 1)

#echo "specified is: $cserver"

defaultserver=$(ls /etc/openvpn/$default* | shuf -n 1)

#echo "default is: $defaultserver"


#if ping -q -c 1 -W 1 8.8.8.8 >/dev/null; then
# 	echo "IPv4 is up"
#else
	
#	echo "IPv4 is down"
killall 'openvpn'

if [ -z "$ccode" ]

then
	echo "no country given, using default:$default"
	echo "Connecting to: $defaultserver"
	sleep 1
	sudo openvpn --config "$defaultserver" --daemon
	touch /home/pi/.config/nordVPiN/default.conf
	echo "$defaultserver" > /home/pi/.config/nordVPiN/default.conf


else
      	echo "Connecting to random $ccode server"
	echo "Connecting to: $cserver"
	sudo openvpn --config "$cserver" --daemon
	touch /home/pi/.config/nordVPiN/default.conf
	echo "$cserver" > /home/pi/.config/nordVPiN/default.conf
fi
sleep 5
proxy

#run the below line to insert authentication from file auth.txt, so that credential validation is not required by this script

#sudo find -name "*.ovpn" | sudo xargs sed -i '/auth-user-pass/ s/$/ \/etc\/openvpn\/auth.txt/'


